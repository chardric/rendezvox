<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin — Login</title>
<link rel="icon" type="image/svg+xml" href="/assets/icon.svg">
<link rel="stylesheet" href="/admin/css/admin.css?v=glow1">
</head>
<body>
<div class="login-wrap">
  <div class="login-box">
    <h1 id="brandTitle">Admin</h1>
    <div class="sub">Admin Panel</div>
    <div id="error" class="text-danger text-center mb-16 hidden"></div>
    <form id="loginForm">
      <label for="username">Username</label>
      <input type="text" id="username" autocomplete="username" required autofocus>
      <label for="password">Password</label>
      <div class="eye-wrap">
        <input type="password" id="password" autocomplete="current-password" required style="padding-right:36px">
        <button type="button" class="eye-toggle" onclick="toggleVis('password',this)" aria-label="Toggle password visibility">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8S1 12 1 12z"/><circle cx="12" cy="12" r="3"/></svg>
        </button>
      </div>
      <button type="submit" class="btn btn-primary" style="width:100%;justify-content:center">Sign In</button>
    </form>
    <div style="text-align:center;margin-top:12px">
      <a href="/admin/forgot-password" style="font-size:.8rem;color:var(--text-dim)">Forgot Password?</a>
    </div>
  </div>
  <footer class="site-footer">&copy; 2026 <a href="https://downstreamtech.net" target="_blank" rel="noopener">DownStreamTech</a>. All rights reserved.</footer>
</div>
<script src="/admin/js/theme.js?v=20260225"></script>
<script src="/admin/js/api.js?v=20260225"></script>
<script src="/admin/js/auth.js?v=20260225"></script>
<script>
(function() {
  // Load station branding + logo
  RendezVoxAPI.get('/config').then(function(cfg) {
    var name = cfg.station_name || 'RendezVox';
    document.getElementById('brandTitle').textContent = name;
    document.title = name + ' Admin — Login';
    if (cfg.has_logo) {
      var img = document.createElement('img');
      img.src = '/api/logo?v=' + Date.now();
      img.alt = name;
      img.style.cssText = 'width:64px;height:64px;object-fit:contain;border-radius:8px;margin:0 auto 12px;display:block';
      var box = document.querySelector('.login-box');
      if (box) box.insertBefore(img, box.firstChild);
    }
  }).catch(function() {});

  if (RendezVoxAuth.isLoggedIn()) {
    window.location.href = '/admin/dashboard';
    return;
  }

  // Check if first-time setup is needed (no users in DB)
  RendezVoxAPI.get('/setup/status').then(function(data) {
    if (data.needs_setup) {
      window.location.href = '/admin/setup';
    }
  }).catch(function() {});

  document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    var errEl = document.getElementById('error');
    errEl.classList.add('hidden');

    var username = document.getElementById('username').value.trim();
    var password = document.getElementById('password').value;

    RendezVoxAPI.post('/admin/login', { username: username, password: password })
      .then(function(data) {
        RendezVoxAuth.login(data.token, data.user);
        window.location.href = '/admin/dashboard';
      })
      .catch(function(err) {
        errEl.textContent = (err && err.error) || 'Login failed';
        errEl.classList.remove('hidden');
      });
  });
})();
</script>
</body>
</html>

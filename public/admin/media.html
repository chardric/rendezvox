<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin — Media</title>
<link rel="icon" type="image/svg+xml" href="/assets/icon.svg">
<link rel="stylesheet" href="/admin/css/admin.css?v=glow1">
<script src="/admin/js/theme.js?v=20260228"></script>
<style>
  /* ── Unified filter bar ──────────────────────────── */
  .filter-bar {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 10px;
  }
  .filter-bar input[type="search"] {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid var(--border, rgba(255,255,255,0.12));
    background: rgba(255,255,255,0.04);
    color: inherit;
    font-size: 0.85rem;
    min-width: 180px; flex: 1; max-width: 280px;
  }
  .filter-bar select {
    padding: 6px 10px;
    border-radius: 6px;
    border: 1px solid var(--border, rgba(255,255,255,0.12));
    background: rgba(255,255,255,0.04);
    color: inherit;
    font-size: 0.85rem;
    min-width: 140px;
  }
  .filter-bar .song-count { font-size: 0.8rem; opacity: 0.45; margin-left: auto; }

  /* ── Bulk action bar ───────────────────────────────── */
  .bulk-bar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: rgba(123, 143, 247, 0.08);
    border: 1px solid rgba(123, 143, 247, 0.25);
    border-radius: 8px;
    margin-bottom: 10px;
    font-size: 0.85rem;
  }
  .bulk-count { font-weight: 600; flex: 1; }

  .badge-inactive { color: #f87171; font-size: 0.7rem; margin-left: 4px; }

  /* ── Upload result list ────────────────────────────── */
  .upload-result-list { max-height: 180px; overflow-y: auto; margin-top: 8px; font-size: 0.82rem; }
  .upload-result-item {
    padding: 4px 0;
    border-bottom: 1px solid var(--border, rgba(255,255,255,0.05));
    display: flex; gap: 8px; align-items: flex-start;
  }
  .res-name { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; opacity: 0.8; }
  .res-err  { color: #f87171; font-size: 0.78rem; }

  /* ── Drop zone ─────────────────────────────────────── */
  .drop-zone {
    border: 2px dashed var(--border, rgba(255,255,255,0.2));
    border-radius: 8px;
    padding: 20px 14px;
    text-align: center;
    transition: border-color 0.15s, background 0.15s;
    margin-bottom: 10px;
    cursor: pointer;
  }
  .drop-zone p { margin: 0 0 8px; opacity: 0.6; font-size: 0.9rem; }
  .drop-zone.drag-over {
    border-color: var(--accent, #7b8ff7);
    background: rgba(123, 143, 247, 0.07);
  }
  .drop-zone .file-list {
    margin-top: 10px;
    font-size: 0.8rem;
    opacity: 0.7;
    max-height: 80px;
    overflow-y: auto;
    text-align: left;
  }

  /* ── Song info row in edit modal ───────────────────── */
  .song-info-row {
    display: flex;
    gap: 20px;
    font-size: 0.82rem;
    opacity: 0.55;
    margin-bottom: 10px;
    padding: 6px 10px;
    background: rgba(255,255,255,0.03);
    border-radius: 6px;
  }
  .song-info-row strong { opacity: 1; font-weight: 600; color: inherit; }

  /* ── Notice banner ─────────────────────────────────── */
  .notice-banner {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    background: rgba(250, 204, 21, 0.08);
    border: 1px solid rgba(250, 204, 21, 0.25);
    border-radius: 8px;
    margin-bottom: 12px;
    font-size: 0.85rem;
    color: #fbbf24;
  }
  .notice-banner .notice-icon { font-size: 1.1rem; flex-shrink: 0; }

  /* ── Pagination ────────────────────────────────────── */
  .pagination-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 10px;
    padding: 0 0 10px;
    margin-bottom: 10px;
    border-bottom: 1px solid var(--border, rgba(255,255,255,0.07));
    font-size: 0.84rem;
  }
  .pagination-info {
    display: flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
  }
  .pagination-info label { opacity: 0.5; margin: 0; font-size: 0.82rem; }
  .pagination-info select {
    padding: 4px 8px;
    border-radius: 6px;
    border: 1px solid var(--border, rgba(255,255,255,0.12));
    background: rgba(255,255,255,0.04);
    color: inherit;
    font-size: 0.82rem;
  }
  #paginationInfo { opacity: 0.5; font-size: 0.82rem; white-space: nowrap; }
  .pagination-nav {
    display: flex;
    align-items: center;
    gap: 2px;
  }
  .pagination-nav button {
    padding: 4px 10px;
    border-radius: 6px;
    border: 1px solid var(--border, rgba(255,255,255,0.12));
    background: rgba(255,255,255,0.04);
    color: inherit;
    font-size: 0.82rem;
    cursor: pointer;
    transition: background 0.15s;
    min-width: 32px;
  }
  .pagination-nav button:hover:not(:disabled) { background: rgba(255,255,255,0.1); }
  .pagination-nav button.active {
    background: var(--accent, #7b8ff7);
    color: #fff;
    border-color: var(--accent, #7b8ff7);
    font-weight: 600;
  }
  .pagination-nav button:disabled { opacity: 0.3; cursor: default; }
  .pagination-nav .page-ellipsis {
    padding: 4px 6px;
    opacity: 0.4;
    font-size: 0.82rem;
  }
  .pagination-show-sel {
    padding: 4px 8px;
    border-radius: 6px;
    border: 1px solid var(--border, rgba(255,255,255,0.12));
    background: rgba(255,255,255,0.04);
    color: inherit;
    font-size: 0.82rem;
    width: auto;
    margin: 0;
    vertical-align: middle;
  }

  /* ── View tabs (Library / Trash) ─────────────────── */
  .view-tabs {
    display: flex;
    gap: 4px;
    margin-bottom: 14px;
    border-bottom: 1px solid var(--border, rgba(255,255,255,0.07));
    padding-bottom: 10px;
  }
  .view-tab {
    padding: 6px 16px;
    border-radius: 6px 6px 0 0;
    border: 1px solid transparent;
    background: none;
    color: inherit;
    font-size: 0.85rem;
    cursor: pointer;
    opacity: 0.5;
    transition: opacity 0.15s, background 0.15s;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .view-tab:hover { opacity: 0.8; }
  .view-tab.active {
    opacity: 1;
    background: rgba(255,255,255,0.06);
    border-color: var(--border, rgba(255,255,255,0.12));
    border-bottom-color: transparent;
    font-weight: 600;
  }
  .trash-badge {
    display: inline-block;
    background: #f87171;
    color: #fff;
    font-size: 0.7rem;
    font-weight: 700;
    padding: 1px 6px;
    border-radius: 10px;
    min-width: 18px;
    text-align: center;
    line-height: 1.4;
  }

  /* ── Duplicate groups (compact) ──────────────────── */
  .dup-group {
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border, rgba(255,255,255,0.1));
    border-radius: 8px;
    padding: 10px 14px;
    margin-bottom: 8px;
  }
  .dup-group-header {
    display: flex; align-items: center; justify-content: space-between;
    cursor: pointer; user-select: none; gap: 8px;
  }
  .dup-group-header:hover { opacity: .85; }
  .dup-group-left { display: flex; align-items: center; gap: 8px; min-width: 0; flex: 1; }
  .dup-group-chevron {
    transition: transform .15s; font-size: .7rem; opacity: .4; flex-shrink: 0;
  }
  .dup-group.open .dup-group-chevron { transform: rotate(90deg); }
  .dup-group-title { font-size: .85rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .dup-group-meta { font-size: .75rem; opacity: .5; white-space: nowrap; flex-shrink: 0; }
  .dup-group-detail { display: none; margin-top: 10px; }
  .dup-group.open .dup-group-detail { display: block; }
  .dup-group table { width: 100%; }
  .dup-group table th { font-size: 0.72rem; opacity: 0.4; text-transform: uppercase; letter-spacing: .3px; padding: 4px 6px; }
  .dup-group table td { font-size: 0.82rem; padding: 4px 6px; }
  .dup-badge-exact {
    background: var(--danger, #f87171); color: #fff;
    padding: 1px 6px; border-radius: 4px; font-size: 0.68rem; font-weight: 600; flex-shrink: 0;
  }
  .dup-badge-likely {
    background: var(--warn, #fbbf24); color: #000;
    padding: 1px 6px; border-radius: 4px; font-size: 0.68rem; font-weight: 600; flex-shrink: 0;
  }
  .dup-keep-radio { cursor: pointer; width: 14px; height: 14px; }
  .dup-pager { display: flex; align-items: center; justify-content: center; gap: 8px; margin-top: 12px; }
  .dup-pager button { padding: 4px 12px; font-size: .8rem; }
  .dup-pager span { font-size: .8rem; opacity: .6; }

  /* ── Trash toolbar ───────────────────────────────── */
  .trash-toolbar {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    background: rgba(248, 113, 113, 0.06);
    border: 1px solid rgba(248, 113, 113, 0.2);
    border-radius: 8px;
    margin-bottom: 12px;
    font-size: 0.85rem;
  }
  .trash-toolbar #trashInfo { flex: 1; opacity: 0.7; }

  /* ── File Manager Layout (embedded) ────────────── */
  .fm-wrap {
    display: flex;
    flex-direction: column;
    height: calc(100vh - 260px);
    min-height: 400px;
  }
  .fm-layout {
    display: flex;
    flex: 1;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    background: var(--bg-card);
  }
  .fm-tree {
    width: 220px;
    min-width: 180px;
    flex-shrink: 0;
    border-right: 1px solid var(--border);
    overflow-y: auto;
    background: var(--bg-card);
  }
  .fm-tree::-webkit-scrollbar { width: 4px; }
  .fm-tree::-webkit-scrollbar-track { background: transparent; }
  .fm-tree::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
  .fm-tn {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 5px 8px;
    cursor: pointer;
    font-size: .82rem;
    color: var(--text);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    user-select: none;
    border-radius: 4px;
    margin: 1px 4px;
  }
  .fm-tn:hover { background: var(--hover-overlay); }
  .fm-tn.active { background: rgba(0,200,160,.12); color: var(--accent); }
  .fm-tn.fm-tn-system .fn-label { opacity: .65; }
  .fn-arr { flex-shrink: 0; transition: transform .15s; opacity: .5; }
  .fn-arr.open { transform: rotate(90deg); }
  .fn-spacer { width: 10px; flex-shrink: 0; display: inline-block; }
  .fn-label { flex: 1; overflow: hidden; text-overflow: ellipsis; }
  .fm-tc { display: none; }
  .fm-tc.open { display: block; }
  .fm-pane {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    min-width: 0;
  }
  .fm-toolbar {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 8px 12px;
    border-bottom: 1px solid var(--border);
    flex-wrap: wrap;
    flex-shrink: 0;
  }
  .fm-divider {
    width: 1px;
    height: 18px;
    background: var(--border);
    margin: 0 3px;
    flex-shrink: 0;
  }
  .fm-status {
    margin-left: auto;
    font-size: .78rem;
    color: var(--text-dim);
    white-space: nowrap;
    flex-shrink: 0;
  }
  .fm-breadcrumb {
    display: flex;
    align-items: center;
    gap: 5px;
    padding: 8px 14px;
    border-bottom: 1px solid var(--border);
    font-size: .82rem;
    flex-wrap: wrap;
    flex-shrink: 0;
  }
  .bc-sep { color: var(--text-dim); }
  .bc-link { color: var(--accent); cursor: pointer; text-decoration: none; }
  .bc-link:hover { text-decoration: underline; }
  .bc-current { color: var(--text); font-weight: 500; }
  .fm-content {
    flex: 1;
    overflow-y: auto;
    padding: 6px;
  }
  .fm-items { display: flex; flex-direction: column; gap: 1px; }
  .fm-empty {
    padding: 60px 20px;
    text-align: center;
    color: var(--text-dim);
    font-size: .9rem;
  }
  .fm-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 10px;
    border-radius: 5px;
    cursor: pointer;
    user-select: none;
    border: 1px solid transparent;
  }
  .fm-item:hover { background: var(--hover-overlay); }
  .fm-item.selected { background: rgba(0,200,160,.1); border-color: rgba(0,200,160,.25); }
  .fm-item.cut-mode { opacity: .45; }
  .fm-item.fm-system { opacity: .7; }
  .fm-item.fm-system:hover { cursor: pointer; }
  .fm-lock { margin-left: 4px; }
  .item-icon { flex-shrink: 0; color: var(--text-dim); display: flex; align-items: center; }
  .item-icon.folder-icon { color: #f59e0b; }
  .item-name { flex: 1; font-size: .875rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; min-width: 0; }
  .item-meta { font-size: .75rem; color: var(--text-dim); flex-shrink: 0; min-width: 60px; text-align: right; }
  .item-actions { flex-shrink: 0; display: flex; gap: 3px; opacity: 0; }
  .fm-item:hover .item-actions,
  .fm-item.selected .item-actions { opacity: 1; }
  .rename-input {
    background: var(--bg-input);
    border: 1px solid var(--accent);
    color: var(--text);
    border-radius: 4px;
    padding: 1px 6px;
    font-size: .875rem;
    min-width: 120px;
    max-width: 300px;
    width: 100%;
    outline: none;
  }
  .ctx-menu {
    position: fixed;
    z-index: 9999;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: 6px;
    box-shadow: 0 6px 20px rgba(0,0,0,.45);
    min-width: 160px;
    padding: 4px 0;
    animation: ctxFadeIn .08s ease;
  }
  @keyframes ctxFadeIn { from { opacity:0; transform:scale(.97); } to { opacity:1; transform:scale(1); } }
  .ctx-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 14px;
    font-size: .83rem;
    cursor: pointer;
    color: var(--text);
  }
  .ctx-item:hover { background: var(--hover-overlay); }
  .ctx-item.ctx-danger { color: var(--danger); }
  .ctx-icon { flex-shrink: 0; opacity: .7; display: flex; }
  .ctx-sep { height: 1px; background: var(--border); margin: 3px 0; }
  .fm-item.dragging { opacity: .3; }
  .fm-item.drag-over,
  .fm-tn.drag-over {
    background: rgba(99,102,241,.15) !important;
    outline: 2px solid var(--primary, #6366f1);
    outline-offset: -2px;
    border-radius: 4px;
  }
  .fm-lasso {
    position: fixed;
    border: 1px solid var(--primary, #6366f1);
    background: rgba(99,102,241,.1);
    pointer-events: none;
    z-index: 9999;
    border-radius: 2px;
  }
  .fm-search-bar {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 6px 14px;
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
  }
  .fm-search-bar .search-wrap { max-width: 100%; min-width: 0; }
  .fm-search-bar input[type="search"] {
    padding: 5px 28px 5px 10px;
    border-radius: 6px;
    border: 1px solid var(--border, rgba(255,255,255,0.12));
    background: rgba(255,255,255,0.04);
    color: inherit;
    font-size: 0.82rem;
    width: 100%;
  }

  /* ── Search clear button ──────────────────────────── */
  input[type="search"]::-webkit-search-cancel-button { display: none; }
  .search-wrap { position: relative; display: inline-flex; align-items: center; flex: 1; max-width: 280px; min-width: 180px; }
  .search-wrap input { width: 100%; padding-right: 28px; }
  .search-x {
    position: absolute; right: 8px;
    background: none; border: none; cursor: pointer; padding: 0;
    color: var(--text-dim); display: none; line-height: 0;
  }
  .search-x:hover { color: #fff; }
  .search-x svg { display: block; }

  /* ── Play button / # column ──────────────────────── */
  .song-num { cursor: default; }
  .song-num .num-text { display: inline; }
  .song-num .play-btn { display: none; cursor: pointer; opacity: .7; }
  .song-num .play-btn:hover { opacity: 1; }
  tr:hover .song-num .num-text { display: none; }
  tr:hover .song-num .play-btn { display: inline; }
  .song-num.is-playing .num-text { display: none !important; color: var(--accent); }
  .song-num.is-playing .play-btn { display: inline !important; }
  .song-num.is-playing .play-btn svg { color: var(--accent); }

  /* ── Playlist picker ─────────────────────────────── */
  .pl-pick-item {
    display: flex; align-items: center; gap: 10px;
    padding: 8px 12px; cursor: pointer; border-bottom: 1px solid var(--border);
    transition: background .15s;
  }
  .pl-pick-item:last-child { border-bottom: none; }
  .pl-pick-item:hover { background: rgba(255,255,255,.05); }
  .pl-pick-item .pl-color {
    width: 10px; height: 10px; border-radius: 50%; flex-shrink: 0;
  }
  .pl-pick-item .pl-name { flex: 1; font-size: .85rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
  .pl-pick-item .pl-badge {
    font-size: .72rem; padding: 1px 6px; border-radius: 8px;
    flex-shrink: 0;
  }
  .pl-pick-item .pl-badge.added {
    background: rgba(34,197,94,.15); color: #22c55e;
  }
  .pl-pick-item .pl-count {
    font-size: .72rem; color: var(--text-dim); flex-shrink: 0;
  }
  .pl-pick-item .pl-check {
    flex-shrink: 0; color: #22c55e; display: flex;
  }
</style>
</head>
<body>
<div class="app">
  <button id="hamburger" class="hamburger">
    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
    </svg>
  </button>
  <div id="overlay" class="overlay"></div>
  <aside id="sidebar" class="sidebar"></aside>

  <main class="main">
    <!-- Header -->
    <div class="flex items-center justify-between" style="margin-bottom:20px">
      <h1 class="page-title" style="margin-bottom:0">Media Library</h1>
      <button class="btn btn-primary" id="btnUpload">&#8593; Upload</button>
    </div>

    <!-- Library Card -->
    <div class="table-wrap" style="padding:16px">

      <!-- View tabs -->
      <div class="view-tabs">
        <button class="view-tab active" id="tabLibrary">Library</button>
        <button class="view-tab" id="tabUpload">Upload</button>
        <button class="view-tab" id="tabFiles">Files</button>
        <button class="view-tab" id="tabTrash">Trash <span class="trash-badge hidden" id="trashBadge">0</span></button>
        <button class="view-tab" id="tabDuplicates">Duplicates <span class="trash-badge hidden" id="dupBadge" style="background:var(--warn,#fbbf24);color:#000">0</span></button>
      </div>

      <!-- Notice banner (pending uploads) -->
      <div id="noticeBanner" class="notice-banner hidden"></div>

      <!-- Inactive info banner -->
      <div id="inactiveBanner" class="notice-banner hidden" style="background:rgba(248,113,113,0.06);border-color:rgba(248,113,113,0.2);color:#f87171">
        <span class="notice-icon">&#9888;</span>
        <span>Inactive songs are excluded from rotation and requests. They can be reactivated or permanently deleted.</span>
      </div>

      <!-- Trash toolbar (shown in trash view) -->
      <div id="trashToolbar" class="trash-toolbar hidden">
        <span id="trashInfo">0 songs in trash</span>
        <button class="btn btn-ghost btn-sm" style="color:#f87171" id="btnEmptyTrash">Empty Trash</button>
      </div>

      <!-- Upload view (inline tab panel) -->
      <div id="uploadView" class="hidden">
        <form id="uploadForm" class="compact-form">
          <!-- Drop zone -->
          <div id="dropZone" class="drop-zone" style="padding:20px 14px;margin-bottom:10px;cursor:pointer">
            <p id="dropZonePrompt">&#127911; Drag &amp; drop files or a folder here</p>
            <p id="dropZoneSubtext" style="font-size:0.78rem;opacity:0.45;margin:4px 0 0">or click to browse files</p>
            <input type="file" id="uploadFiles" accept="audio/*" multiple style="display:none">
            <div class="file-list" id="dropFileList"></div>
            <button type="button" class="btn btn-ghost btn-sm hidden" id="btnClearDrop" style="margin-top:8px">Clear</button>
          </div>

          <div class="form-row hidden" id="uploadGenreRow">
            <div style="flex:1">
              <label for="uploadGenreSel">Genre *</label>
              <div class="flex gap-8 items-center">
                <select id="uploadGenreSel" style="margin-bottom:0;flex:1"></select>
                <button type="button" class="btn btn-ghost btn-sm" id="btnNewGenre">+</button>
              </div>
            </div>
            <div style="flex:1">
              <label for="uploadArtist">Artist</label>
              <div class="flex gap-8 items-center">
                <select id="uploadArtist" style="margin-bottom:0;flex:1"></select>
                <button type="button" class="btn btn-ghost btn-sm" id="btnNewArtist">+</button>
              </div>
            </div>
          </div>

          <p id="uploadHint" class="hidden" style="font-size:0.78rem;opacity:0.45;margin:2px 0 8px">Title and artist are auto-read from ID3 tags by the organizer.</p>

          <!-- Upload progress bar -->
          <div id="uploadProgress" class="hidden" style="margin-bottom:8px">
            <div style="display:flex;justify-content:space-between;font-size:.82rem;margin-bottom:4px">
              <span id="uploadProgressLabel">Uploading...</span>
              <span id="uploadProgressPct">0%</span>
            </div>
            <div style="background:var(--bg-input,rgba(255,255,255,0.06));border-radius:4px;height:8px;overflow:hidden">
              <div id="uploadProgressBar" style="background:var(--accent,#7b8ff7);height:100%;width:0;transition:width .2s"></div>
            </div>
            <div id="uploadProgressSize" style="font-size:.75rem;color:var(--text-dim);margin-top:4px"></div>
          </div>

          <!-- Batch result display -->
          <div id="uploadResults" class="hidden">
            <p id="uploadSummary" style="font-size:0.85rem;margin-bottom:6px"></p>
            <div class="upload-result-list" id="uploadResultList"></div>
          </div>

          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
            <button type="button" class="btn btn-ghost" id="btnCancelUpload">Cancel</button>
            <button type="submit" class="btn btn-primary" id="btnSubmitUpload">Upload</button>
          </div>
        </form>
      </div>

      <!-- Files view (embedded file manager) -->
      <div id="filesView" class="hidden">
        <div class="fm-wrap">
          <!-- Toolbar -->
          <div class="fm-toolbar">
            <button class="btn btn-ghost btn-sm" id="fm-btnNewFolder">
              <svg viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:3px"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg>New Folder
            </button>
            <div class="fm-divider"></div>
            <button class="btn btn-ghost btn-sm" id="fm-btnCut" disabled>
              <svg viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:3px"><circle cx="6" cy="20" r="2"/><circle cx="6" cy="4" r="2"/><line x1="6" y1="2" x2="6" y2="22"/><line x1="21" y1="2" x2="6" y2="22"/><line x1="21" y1="22" x2="6" y2="2"/></svg>Cut
            </button>
            <button class="btn btn-ghost btn-sm" id="fm-btnCopy" disabled>
              <svg viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:3px"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>Copy
            </button>
            <button class="btn btn-ghost btn-sm" id="fm-btnPaste" disabled>
              <svg viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:3px"><path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/><rect x="8" y="2" width="8" height="4" rx="1"/></svg>Paste
            </button>
            <div class="fm-divider"></div>
            <button class="btn btn-ghost btn-sm" id="fm-btnRename" disabled>
              <svg viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:3px"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4z"/></svg>Rename
            </button>
            <button class="btn btn-sm" id="fm-btnDelete" disabled style="color:var(--danger);border-color:var(--danger);background:transparent;">
              <svg viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:3px"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6"/><path d="M14 11v6"/><path d="M9 6V4h6v2"/></svg>Delete
            </button>
            <div class="fm-divider"></div>
            <button class="btn btn-ghost btn-sm" id="fm-btnSelectAll" title="Select All (Ctrl+A)">
              <svg viewBox="0 0 24 24" width="13" height="13" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:3px"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>Select All
            </button>
            <span id="fm-status" class="fm-status"></span>
          </div>

          <!-- Two-panel layout -->
          <div class="fm-layout">
            <div id="fm-tree" class="fm-tree">
              <div style="padding:20px;color:var(--text-dim);font-size:.82rem">Select Files tab to load...</div>
            </div>
            <div class="fm-pane">
              <div id="fm-breadcrumb" class="fm-breadcrumb"></div>
              <div class="fm-search-bar" id="fm-searchBar" style="display:none">
                <span class="search-wrap" style="flex:1;max-width:100%;min-width:0">
                  <input type="search" id="fm-search" placeholder="Filter by name, ext (flac, mp3, *.ogg)">
                  <button type="button" class="search-x" id="fm-btnClearSearch" title="Clear" style="display:none">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="7" y1="7" x2="17" y2="17"/><line x1="17" y1="7" x2="7" y2="17"/></svg>
                  </button>
                </span>
                <span id="fm-searchCount" style="font-size:.78rem;color:var(--text-dim);white-space:nowrap"></span>
              </div>
              <div id="fm-content" class="fm-content">
                <div class="fm-empty">Select Files tab to load...</div>
              </div>
            </div>
          </div>
        </div>
        <div style="margin-top:8px;font-size:.74rem;color:var(--text-dim)">
          Ctrl+A select all &nbsp;·&nbsp; Ctrl+C copy &nbsp;·&nbsp; Ctrl+X cut &nbsp;·&nbsp; Ctrl+V paste &nbsp;·&nbsp; Del delete &nbsp;·&nbsp; F2 rename &nbsp;·&nbsp; Double-click to open folder
        </div>
      </div>

      <!-- Duplicates view -->
      <div id="duplicatesView" class="hidden">
        <div class="flex items-center justify-between" style="margin-bottom:12px">
          <div>
            <p class="text-dim" id="dupSummary" style="font-size:.85rem"></p>
            <p class="text-dim" id="dupDiskInfo" style="font-size:.78rem;margin-top:2px"></p>
          </div>
          <div class="flex gap-8">
            <button class="btn btn-primary btn-sm" id="btnDupScan">Scan for Duplicates</button>
            <button class="btn btn-sm" id="btnDupDeleteAll" style="display:none;background:var(--danger);color:#fff">Mark All as Duplicates</button>
            <button class="btn btn-sm" id="btnDupPurge" style="display:none;background:var(--warn,#f59e0b);color:#000">Purge Duplicate Files</button>
          </div>
        </div>
        <div id="dupResults"></div>
      </div>

      <!-- Filter bar (search + genre + artist + inactive + count) -->
      <div class="filter-bar" id="filterBar">
        <span class="search-wrap">
          <input type="search" id="songSearch" placeholder="Search...">
          <button type="button" class="search-x" id="btnClearSearch" title="Clear">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="7" y1="7" x2="17" y2="17"/><line x1="17" y1="7" x2="7" y2="17"/></svg>
          </button>
        </span>
        <select id="filterGenre">
          <option value="">All Genres</option>
        </select>
        <select id="filterArtist">
          <option value="">All Artists</option>
        </select>
        <div style="display:flex;align-items:center;gap:6px">
          <span style="font-size:0.82rem;opacity:0.5">Inactive</span>
          <label class="toggle toggle-sm" style="margin:0" title="Show inactive songs">
            <input type="checkbox" id="showInactive">
            <span class="slider"></span>
          </label>
          <span class="trash-badge hidden" id="inactiveBadge" style="background:#f87171">0</span>
        </div>
        <button class="btn btn-ghost btn-sm hidden" style="color:#f87171" id="btnPurgeInactive">Purge All Inactive</button>
        <span class="song-count" id="songCount" style="margin-left:auto"></span>
      </div>

      <!-- Bulk action bar -->
      <div id="bulkBar" class="bulk-bar hidden">
        <span class="bulk-count" id="bulkCount">0 selected</span>
        <span id="bulkLibraryActions">
          <button class="btn btn-ghost btn-sm" id="btnBulkAddPlaylist">Add to Playlist</button>
          <button class="btn btn-ghost btn-sm" style="color:#f87171" id="btnBulkTrash">Move to Trash</button>
        </span>
        <span id="bulkInactiveActions" class="hidden">
          <button class="btn btn-ghost btn-sm" id="btnBulkReactivate">Reactivate</button>
          <button class="btn btn-ghost btn-sm" style="color:#f87171" id="btnBulkPurgeInactive">Delete Selected</button>
        </span>
        <span id="bulkTrashActions" class="hidden">
          <button class="btn btn-ghost btn-sm" id="btnBulkRestore">Restore</button>
          <button class="btn btn-ghost btn-sm" style="color:#f87171" id="btnBulkPurge">Delete Forever</button>
        </span>
        <button class="btn btn-ghost btn-sm" id="btnClearSel">Clear</button>
      </div>

      <!-- Pagination -->
      <div class="pagination-bar" id="paginationBar" style="display:none">
        <span id="paginationInfo" style="font-size:.82rem;opacity:.5"></span>
        <div class="pagination-nav" id="paginationNav"></div>
      </div>
      <div style="text-align:right;font-size:.82rem;margin:-8px 0 10px;opacity:.6">
        Show
        <select id="perPageSel" class="pagination-show-sel">
          <option value="10">10</option>
          <option value="25" selected>25</option>
          <option value="50">50</option>
          <option value="100">100</option>
          <option value="all">All</option>
        </select>
        per page
      </div>

      <!-- Songs table -->
      <div id="songSection">
        <div style="overflow-x:auto">
          <table>
            <thead>
              <tr>
                <th style="width:32px;text-align:center;padding-right:4px">
                  <input type="checkbox" id="checkAll" title="Select all">
                </th>
                <th style="width:36px;text-align:center">#</th>
                <th>Title</th>
                <th>Artist</th>
                <th>Genre</th>
                <th>Path</th>
                <th style="white-space:nowrap">Duration</th>
                <th style="white-space:nowrap">Date Added</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="songTable">
              <tr><td colspan="9" class="empty">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- New Folder Modal (File Manager) -->
<div id="fmNewFolderModal" class="modal-backdrop" style="display:none">
  <div class="modal" style="max-width:340px">
    <h3>New Folder</h3>
    <button type="button" class="modal-close" id="fmBtnCancelFolderX">&times;</button>
    <div style="margin:16px 0">
      <label style="font-size:.82rem;color:var(--text-dim);display:block;margin-bottom:6px">Folder name</label>
      <input type="text" id="fmNewFolderName" placeholder="e.g. Rock / Jazz / Oldies" style="width:100%">
    </div>
    <div class="modal-actions">
      <button type="button" class="btn btn-ghost" id="fmBtnCancelFolder">Cancel</button>
      <button type="button" class="btn btn-primary" id="fmBtnCreateFolder">Create</button>
    </div>
  </div>
</div>

<!-- Edit Song Modal -->
<div class="modal-backdrop hidden" id="editModal">
  <div class="modal" style="max-width:520px;width:95%">
    <button type="button" class="modal-close" onclick="this.closest('.modal-backdrop').classList.add('hidden')">&times;</button>
    <h3>Edit Metadata</h3>
    <form id="editForm" class="compact-form">
      <input type="hidden" id="editId">

      <!-- Info row (read-only) -->
      <div class="song-info-row" style="margin-bottom:10px;padding:6px 10px">
        <span>Duration: <strong id="editDuration">-</strong></span>
        <span>Plays: <strong id="editPlayCount">-</strong></span>
        <span>Year: <strong id="editYearInfo">-</strong></span>
      </div>

      <div class="form-row">
        <div style="flex:1">
          <label for="editTitle">Title *</label>
          <input type="text" id="editTitle" required>
        </div>
        <div>
          <label for="editYear">Year</label>
          <input type="number" id="editYear" min="1900" max="2099" step="1" placeholder="-" style="max-width:80px">
        </div>
      </div>

      <div class="form-row">
        <div style="flex:1">
          <label for="editArtist">Artist</label>
          <select id="editArtist"></select>
        </div>
        <div style="flex:1">
          <label for="editGenre">Genre</label>
          <div class="flex gap-8 items-center">
            <select id="editGenre" style="margin-bottom:0;flex:1"></select>
            <button type="button" class="btn btn-ghost btn-sm" id="btnNewGenreEdit">+</button>
          </div>
        </div>
      </div>

      <div class="flex" style="gap:12px;align-items:flex-end">
        <div>
          <label for="editWeight">Weight</label>
          <input type="number" id="editWeight" step="0.1" min="0" style="max-width:100px">
        </div>
        <div style="display:flex;gap:16px;align-items:center;padding-bottom:10px">
          <div style="display:flex;align-items:center;gap:6px">
            <label style="margin:0">Active</label>
            <label class="toggle toggle-sm" style="margin:0">
              <input type="checkbox" id="editActive">
              <span class="slider"></span>
            </label>
          </div>
          <div style="display:flex;align-items:center;gap:6px">
            <label style="margin:0">Requestable</label>
            <label class="toggle toggle-sm" style="margin:0">
              <input type="checkbox" id="editRequestable">
              <span class="slider"></span>
            </label>
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn btn-ghost" id="btnCancelEdit">Cancel</button>
        <button type="submit" class="btn btn-primary">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<!-- New Genre Modal -->
<div class="modal-backdrop hidden" id="genreModal">
  <div class="modal">
    <button type="button" class="modal-close" onclick="this.closest('.modal-backdrop').classList.add('hidden')">&times;</button>
    <h3>New Genre</h3>
    <form id="genreForm" class="compact-form">
      <label for="newGenreName">Genre Name *</label>
      <input type="text" id="newGenreName" required maxlength="100" placeholder="e.g. Bossa Nova">
      <div class="modal-actions">
        <button type="button" class="btn btn-ghost" id="btnCancelGenre">Cancel</button>
        <button type="submit" class="btn btn-primary">Create</button>
      </div>
    </form>
  </div>
</div>

<!-- New Artist Modal -->
<div class="modal-backdrop hidden" id="artistModal">
  <div class="modal">
    <button type="button" class="modal-close" onclick="this.closest('.modal-backdrop').classList.add('hidden')">&times;</button>
    <h3>New Artist</h3>
    <form id="artistForm" class="compact-form">
      <label for="newArtistName">Artist Name *</label>
      <input type="text" id="newArtistName" required>
      <div class="modal-actions">
        <button type="button" class="btn btn-ghost" id="btnCancelArtist">Cancel</button>
        <button type="submit" class="btn btn-primary">Create</button>
      </div>
    </form>
  </div>
</div>

<!-- Audio preview element -->
<audio id="audioPreview" preload="none"></audio>

<!-- Add to Playlist Picker Modal -->
<div class="modal-backdrop hidden" id="playlistPickerModal">
  <div class="modal" style="max-width:400px;width:95%">
    <button type="button" class="modal-close" onclick="this.closest('.modal-backdrop').classList.add('hidden')">&times;</button>
    <h3 id="playlistPickerTitle">Add to Playlist</h3>
    <div style="margin:10px 0 8px">
      <input type="text" id="playlistPickerSearch" placeholder="Search playlists..." style="width:100%;margin-bottom:0">
    </div>
    <div id="playlistPickerCreate" style="margin-bottom:8px">
      <button type="button" class="btn btn-ghost btn-sm" id="btnPlaylistPickerNew" style="width:100%;text-align:left;padding:8px 10px;display:flex;align-items:center;gap:8px">
        <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        New Playlist
      </button>
    </div>
    <div id="playlistPickerList" style="max-height:320px;overflow-y:auto;border:1px solid var(--border);border-radius:6px"></div>
  </div>
</div>

<div class="toast-container" id="toasts"></div>

<script src="/assets/scroll-controls.js?v=20260226"></script>
<script src="/admin/js/api.js?v=20260301"></script>
<script src="/admin/js/auth.js?v=20260301"></script>
<script src="/admin/js/nav.js?v=20260301"></script>
<script src="/admin/js/icons.js?v=20260226"></script>
<script src="/admin/js/confirm.js?v=20260226"></script>
<script src="/admin/js/filemanager.js?v=20260301"></script>
<script src="/admin/js/media.js?v=20260301"></script>
<script>
  if (RendezVoxAuth.requireLogin()) {
    RendezVoxNav.init();
    RendezVoxMedia.init();
  }
</script>
</body>
</html>

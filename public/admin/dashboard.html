<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin — Dashboard</title>
<link rel="icon" type="image/svg+xml" href="/assets/icon.svg">
<link rel="stylesheet" href="/admin/css/admin.css?v=glow1">
<script src="/admin/js/theme.js?v=20260228"></script>
<style>
/* ── DJ Booth Monitor ────────────────────────────────── */
.dj-booth {
  display: flex;
  align-items: center;
  gap: 20px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-left: 4px solid var(--accent);
  border-radius: 10px;
  padding: 14px 20px;
  margin-bottom: 24px;
  flex-wrap: wrap;
}
/* DJ Turntable */
.dj-turntable {
  position: relative; width: 110px; flex-shrink: 0;
}
.dj-turntable::before {
  content: ''; position: absolute;
  width: 84px; height: 84px; border-radius: 50%;
  top: 0; left: 50%; transform: translateX(-50%);
  background: linear-gradient(135deg,transparent 35%,rgba(255,255,255,.08) 46%,rgba(255,255,255,.16) 50%,rgba(255,255,255,.08) 54%,transparent 65%);
  z-index: 1; pointer-events: none;
}
.dj-vinyl {
  width: 84px; height: 84px; border-radius: 50%; margin: 0 auto;
  position: relative;
  background:
    conic-gradient(from 30deg,
      transparent 0%,rgba(255,255,255,.1) 8%,transparent 18%,
      rgba(255,255,255,.08) 30%,transparent 42%,
      rgba(255,255,255,.12) 55%,transparent 65%,
      rgba(255,255,255,.06) 78%,transparent 90%),
    radial-gradient(circle,transparent 21%,rgba(255,255,255,.08) 21.3%,transparent 21.8%,
    transparent 30%,rgba(255,255,255,.06) 30.3%,transparent 30.8%,
    transparent 39%,rgba(255,255,255,.08) 39.3%,transparent 39.8%,
    transparent 55%,rgba(255,255,255,.07) 55.3%,transparent 55.8%,
    transparent 65%,rgba(255,255,255,.08) 65.3%,transparent 65.8%,
    transparent 75%,rgba(255,255,255,.06) 75.3%,transparent 75.8%,
    transparent 85%,rgba(255,255,255,.08) 85.3%,transparent 85.8%,
    transparent 93%,rgba(255,255,255,.06) 93.3%,transparent 93.8%),
    radial-gradient(circle,#222 22%,#181818 50%,#111 80%,#0a0a0a);
  box-shadow: 0 2px 10px rgba(0,0,0,.4), inset 0 0 3px rgba(255,255,255,.06);
}
.dj-vinyl.spinning { animation: dj-vinyl-spin 4s linear infinite; }
@keyframes dj-vinyl-spin { to { transform: rotate(360deg); } }
.dj-vinyl-label {
  position: absolute; width: 44%; height: 44%; border-radius: 50%;
  top: 50%; left: 50%; transform: translate(-50%,-50%);
  overflow: hidden; z-index: 1;
  background: var(--accent);
  display: flex; align-items: center; justify-content: center;
}
.dj-vinyl-label img {
  width: 100%; height: 100%; object-fit: cover; border-radius: 50%; display: block;
}
.dj-vinyl-hole {
  position: absolute; width: 4px; height: 4px; border-radius: 50%;
  background: #000; top: 50%; left: 50%; transform: translate(-50%,-50%); z-index: 2;
  box-shadow: inset 0 0 1px rgba(255,255,255,.15);
}
.dj-tonearm {
  position: absolute; width: 18px; height: 62px;
  top: -1px; right: 3px; z-index: 3;
  transform-origin: 50% 10%;
  transform: rotate(-20deg) translateY(-1px);
  transition: transform .6s cubic-bezier(.4,0,.2,1);
  pointer-events: none; filter: drop-shadow(0 1px 2px rgba(0,0,0,.5));
}
.dj-arm-rest {
  position: absolute; right: 0; top: 26px; z-index: 2;
  width: 8px; height: 11px;
  pointer-events: none;
  filter: drop-shadow(0 1px 1px rgba(0,0,0,.5));
}
.dj-left { display: flex; flex-direction: column; gap: 4px; min-width: 0; }
.dj-live {
  display: inline-flex; align-items: center; gap: 6px;
  font-size: .7rem; font-weight: 700; letter-spacing: .06em;
  text-transform: uppercase; color: var(--text-dim);
}
.dj-live.on { color: #f87171; }
.dj-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: currentColor; flex-shrink: 0;
}
.dj-live.on .dj-dot { animation: djpulse 1.2s ease-in-out infinite; }
@keyframes djpulse { 0%,100% { opacity:1; } 50% { opacity:.25; } }
.dj-title {
  font-size: 1rem; font-weight: 600;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  max-width: 220px;
}
.dj-artist {
  font-size: .83rem; color: var(--text-dim);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  max-width: 220px;
}
.dj-center { flex: 1; min-width: 160px; }
.dj-progress-track {
  height: 5px; background: rgba(255,255,255,.1);
  border-radius: 5px; overflow: hidden; margin-bottom: 5px;
}
.dj-progress-fill {
  height: 100%; background: var(--accent);
  border-radius: 5px; width: 0%;
  transition: width .5s linear;
}
.dj-times {
  display: flex; justify-content: space-between;
  font-size: .72rem; color: var(--text-dim);
}
.dj-right { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
.dj-btn {
  display: inline-flex; align-items: center; justify-content: center;
  width: 38px; height: 38px; border-radius: 50%; border: none;
  background: rgba(255,255,255,.07); color: var(--text);
  cursor: pointer; transition: background .15s, transform .1s, color .15s;
  flex-shrink: 0;
}
.dj-btn:hover { background: rgba(0,200,160,.3); color: #fff; }
.dj-btn:active { transform: scale(.92); }
.dj-btn:disabled { opacity: .4; cursor: not-allowed; }
.dj-btn.active { background: var(--accent); color: #fff; }
.dj-vol { display: flex; align-items: center; gap: 6px; color: var(--text-dim); }
.dj-vol input[type=range] {
  width: 76px; accent-color: var(--accent);
  cursor: pointer; vertical-align: middle;
}
@media (max-width: 600px) {
  .dj-center { order: 3; flex-basis: 100%; min-width: 0; }
  .dj-right   { margin-left: auto; }
  .dj-title, .dj-artist { max-width: 160px; }
}
/* ── DJ Clock (inline in page header) ─────────────── */
.dash-header {
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 8px 16px;
  margin-bottom: 20px;
}
.dash-header .page-title { margin-bottom: 0; }
.dj-clock {
  display: flex;
  align-items: baseline;
  gap: 10px;
  flex-shrink: 0;
}
.dj-clock-time {
  font-size: 1.5rem;
  font-weight: 700;
  letter-spacing: .02em;
  font-variant-numeric: tabular-nums;
  color: var(--text-heading);
  line-height: 1;
}
.dj-clock-seconds {
  font-size: .95rem;
  opacity: .5;
  font-weight: 600;
}
.dj-clock-period {
  font-size: .85rem;
  opacity: .5;
  font-weight: 600;
  margin-left: 2px;
}
.dj-clock-date {
  font-size: .8rem;
  color: var(--text-dim);
  white-space: nowrap;
}
.dj-clock-sep {
  color: var(--border);
  font-size: .8rem;
  user-select: none;
}
.dj-clock-weather {
  display: none;
  align-items: center;
  gap: 10px;
  font-size: .78rem;
  color: var(--text-dim);
}
.dj-clock-weather.visible { display: flex; }
.wx-item {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 3px;
  cursor: default;
}
.wx-item svg { vertical-align: middle; flex-shrink: 0; }
.wx-item .wx-val { font-weight: 600; color: var(--text); font-size: .78rem; }
.wx-item .wx-tip {
  position: absolute;
  bottom: calc(100% + 6px);
  left: 50%;
  transform: translateX(-50%);
  background: var(--surface-alt, #23232a);
  color: var(--text);
  padding: 4px 10px;
  border-radius: 6px;
  font-size: .72rem;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity .15s;
  z-index: 10;
}
.wx-item:hover .wx-tip { opacity: 1; }
@media (max-width: 600px) {
  .dash-header { flex-direction: column; gap: 4px; }
  .dj-clock { flex-wrap: wrap; gap: 6px; }
  .dj-clock-time { font-size: 1.2rem; }
  .dj-clock-seconds { font-size: .8rem; }
  .dj-clock-period { font-size: .75rem; }
}
/* ── Stream Control ─────────────────────────────────── */
.stream-ctrl {
  display: flex; align-items: center; gap: 14px;
  margin-bottom: 24px;
}
.btn-stream {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 9px 22px; border-radius: 8px; border: none;
  font-weight: 600; font-size: .85rem;
  cursor: pointer; transition: background .15s, opacity .15s;
}
.btn-stream:disabled { opacity: .5; cursor: not-allowed; }
.btn-stream.active { background: #f87171; color: #fff; }
.btn-stream:not(.active) { background: #4ade80; color: #0a0a0c; }
.btn-stream-icon { flex-shrink: 0; }
.stream-status { font-size: .82rem; font-weight: 600; }
</style>
</head>
<body>
<div class="app">
  <button id="hamburger" class="hamburger">
    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
  </button>
  <div id="overlay" class="overlay"></div>
  <aside id="sidebar" class="sidebar"></aside>

  <main class="main">
    <div class="dash-header">
      <h1 class="page-title">Dashboard</h1>
      <div class="dj-clock">
        <span class="dj-clock-time" id="djClockTime">00:00<span class="dj-clock-seconds">:00</span></span>
        <span class="dj-clock-sep">&middot;</span>
        <span class="dj-clock-date" id="djClockDate"></span>
        <span class="dj-clock-weather" id="djClockWeather"></span>
      </div>
    </div>

    <div class="tabs" id="dashboardTabs">
      <button class="tab active" data-tab="dashboard">Dashboard</button>
      <button class="tab" data-tab="recent">Recently Played</button>
      <button class="tab" data-tab="library">Library</button>
    </div>

    <!-- ── Dashboard tab (Monitor + Status) ──────────── -->
    <div class="tab-panel active" id="tab-dashboard">

      <!-- DJ Booth Monitor -->
      <div class="dj-booth" id="djBooth">
        <div class="dj-turntable" id="djTurntable">
          <div class="dj-vinyl" id="djVinyl">
            <div class="dj-vinyl-label" id="djCoverLabel"></div>
            <div class="dj-vinyl-hole"></div>
          </div>
          <svg class="dj-arm-rest" viewBox="0 0 14 22" fill="none">
            <defs><linearGradient id="djRestMtl" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#666"/><stop offset="50%" stop-color="#aaa"/><stop offset="100%" stop-color="#666"/></linearGradient></defs>
            <ellipse cx="7" cy="20" rx="5.5" ry="2" fill="#3a3a3a" stroke="#4a4a4a" stroke-width=".3"/>
            <rect x="5.5" y="8" width="3" height="13" rx="1" fill="url(#djRestMtl)"/>
            <path d="M3 9 C3 4 4.5 1.5 7 1.5 C9.5 1.5 11 4 11 9" stroke="url(#djRestMtl)" stroke-width="1.4" fill="none" stroke-linecap="round"/>
            <rect x="5" y="8" width="4" height="1.5" rx=".5" fill="#2a2a2a"/>
          </svg>
          <svg class="dj-tonearm" id="djTonearm" viewBox="0 0 40 138" fill="none">
            <defs><linearGradient id="djArmMtl" x1="0" y1="0" x2="1" y2="0"><stop offset="0%" stop-color="#888"/><stop offset="40%" stop-color="#ccc"/><stop offset="60%" stop-color="#bbb"/><stop offset="100%" stop-color="#777"/></linearGradient></defs>
            <ellipse cx="20" cy="5" rx="6" ry="4" fill="#444" stroke="#555" stroke-width=".5"/>
            <circle cx="20" cy="14" r="4" fill="#666"/>
            <circle cx="20" cy="14" r="2.5" fill="#555" stroke="#777" stroke-width=".5"/>
            <rect x="19" y="14" width="2.5" height="90" rx="1.2" fill="url(#djArmMtl)"/>
            <line x1="20.2" y1="104" x2="13" y2="114" stroke="#aaa" stroke-width="2.5" stroke-linecap="round"/>
            <rect x="9.5" y="112" width="8" height="4.5" rx="1" fill="#333" stroke="#555" stroke-width=".5"/>
            <circle cx="13.5" cy="119" r="1.3" fill="#e33"/>
          </svg>
        </div>
        <div class="dj-left">
          <div class="dj-live" id="djLive"><span class="dj-dot"></span><span id="djLiveLabel">IDLE</span></div>
          <div class="dj-title" id="djTitle">— Idle —</div>
          <div class="dj-artist" id="djArtist"></div>
        </div>
        <div class="dj-center">
          <div class="dj-progress-track">
            <div class="dj-progress-fill" id="djProgressFill"></div>
          </div>
          <div class="dj-times">
            <span id="djElapsed">0:00</span>
            <span id="djRemaining">—</span>
          </div>
        </div>
        <div class="dj-right">
          <button class="dj-btn" id="djPlayBtn" title="Monitor stream">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
          </button>
          <button class="dj-btn" id="djSkipBtn" title="Skip to next track">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zm8-12v12l8.5-6z"/></svg>
          </button>
          <a class="dj-btn" href="/?preview=1" target="_blank" rel="noopener" title="Open listener page">
            <svg viewBox="0 0 24 24" width="17" height="17" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
          </a>
          <div class="dj-vol">
            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="flex-shrink:0"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
            <input type="range" id="djVolume" min="0" max="100" value="80">
          </div>
        </div>
      </div>
      <!-- Stream control -->
      <div class="stream-ctrl">
        <button class="btn-stream active" id="streamToggle">
          <svg class="btn-stream-icon" viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path id="streamIcon" d="M6 6h12v12H6z"/></svg>
          <span id="streamLabel">Stop Stream</span>
        </button>
        <span class="stream-status" id="streamStatus">Broadcasting</span>
      </div>

      <!-- Status cards -->
      <div class="cards" id="cards">
        <div class="card">
          <div class="card-label">Now Playing</div>
          <div class="card-value" id="npTitle">—</div>
          <div class="card-sub" id="npArtist"></div>
          <div class="card-sub" id="npPlaylist" style="font-size:.75rem;color:var(--accent);margin-top:2px"></div>
          <div class="mt-8" id="npBadge"></div>
        </div>
        <div class="card">
          <div class="card-label">Up Next</div>
          <div class="card-value" id="ntTitle">—</div>
          <div class="card-sub" id="ntArtist"></div>
          <div class="card-sub" id="ntPlaylist" style="font-size:.75rem;color:var(--accent);margin-top:2px"></div>
          <div class="mt-8" id="ntBadge"></div>
        </div>
        <div class="card">
          <div class="card-label">Listeners</div>
          <div class="card-value" id="listenerCount">0</div>
          <div class="card-sub">Peak today: <span id="listenerPeak">0</span></div>
        </div>
        <div class="card">
          <div class="card-label">Emergency Mode</div>
          <div class="card-value">
            <label class="toggle">
              <input type="checkbox" id="emergencyToggle">
              <span class="slider"></span>
            </label>
          </div>
          <div class="card-sub" id="emergencyStatus">Inactive</div>
        </div>
        <div class="card">
          <div class="card-label">Request Queue</div>
          <div class="card-value" id="approvedRequests">0</div>
          <div class="card-sub">Pending approval: <span id="pendingRequests">0</span></div>
        </div>
        <div class="card">
          <div class="card-label">Auto-approve Requests</div>
          <div class="card-value">
            <label class="toggle">
              <input type="checkbox" id="autoApproveToggle">
              <span class="slider"></span>
            </label>
          </div>
          <div class="card-sub" id="autoApproveStatus">Off</div>
        </div>
        <div class="card">
          <div class="card-label">Auto-tag Songs</div>
          <div class="card-value">
            <label class="toggle">
              <input type="checkbox" id="autoTagToggle">
              <span class="slider"></span>
            </label>
          </div>
          <div class="card-sub" id="autoTagStatus">Off</div>
        </div>
        <div class="card">
          <div class="card-label">Auto-normalize</div>
          <div class="card-value">
            <label class="toggle">
              <input type="checkbox" id="autoNormToggle">
              <span class="slider"></span>
            </label>
          </div>
          <div class="card-sub" id="autoNormStatus">Off</div>
        </div>
        <div class="card">
          <div class="card-label">Auto-sync Library</div>
          <div class="card-value">
            <label class="toggle">
              <input type="checkbox" id="autoSyncToggle">
              <span class="slider"></span>
            </label>
          </div>
          <div class="card-sub" id="autoSyncStatus">Off</div>
        </div>
        <div class="card">
          <div class="card-label">Auto-dedup Artists</div>
          <div class="card-value">
            <label class="toggle">
              <input type="checkbox" id="autoDedupArtistsToggle">
              <span class="slider"></span>
            </label>
          </div>
          <div class="card-sub" id="autoDedupArtistsStatus">Off</div>
        </div>
        <div class="card">
          <div class="card-label">Auto-dedup Songs</div>
          <div class="card-value">
            <label class="toggle">
              <input type="checkbox" id="autoDedupSongsToggle">
              <span class="slider"></span>
            </label>
          </div>
          <div class="card-sub" id="autoDedupSongsStatus">Off</div>
        </div>
        <div class="card">
          <div class="card-label">Auto-rename Paths</div>
          <div class="card-value">
            <label class="toggle">
              <input type="checkbox" id="autoRenameToggle">
              <span class="slider"></span>
            </label>
          </div>
          <div class="card-sub" id="autoRenameStatus">Off</div>
        </div>
      </div>
    </div>

    <!-- ── Recently Played tab ──────────────────────── -->
    <div class="tab-panel" id="tab-recent">
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Played At</th>
              <th>Title</th>
              <th>Artist</th>
              <th>Genre</th>
              <th>Source</th>
            </tr>
          </thead>
          <tbody id="recentPlays">
            <tr><td colspan="5" class="empty">Loading…</td></tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- ── Library tab ───────────────────────────────── -->
    <div class="tab-panel" id="tab-library">
      <div class="card" style="padding:24px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <h3 class="settings-section-title" style="margin-bottom:0">Library Overview</h3>
          <button class="btn btn-ghost btn-sm" id="btnRefreshStats" style="font-size:.75rem">Refresh</button>
        </div>
        <div id="libraryStats" class="stats-grid">
          <div class="spinner"></div>
        </div>
      </div>

      <div id="libraryNotices" style="display:none;margin-top:16px">
        <h3 class="settings-section-title" style="margin-bottom:12px">Notices</h3>
        <div id="libraryNoticesGrid" class="stats-grid"></div>
      </div>
    </div>
  </main>
</div>

<div class="toast-container" id="toasts"></div>

<script src="/assets/scroll-controls.js?v=20260226"></script>
<script src="/admin/js/api.js?v=20260301"></script>
<script src="/admin/js/auth.js?v=20260301"></script>
<script src="/admin/js/nav.js?v=20260301"></script>
<script src="/admin/js/dashboard.js?v=20260301"></script>
<script>
  if (RendezVoxAuth.requireLogin()) {
    RendezVoxNav.init();
    RendezVoxDashboard.init();
  }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin — Dashboard</title>
<link rel="icon" type="image/svg+xml" href="/assets/icon.svg">
<link rel="stylesheet" href="/admin/css/admin.css">
<style>
/* ── DJ Booth Monitor ────────────────────────────────── */
.dj-booth {
  display: flex;
  align-items: center;
  gap: 20px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-left: 4px solid var(--accent);
  border-radius: 10px;
  padding: 14px 20px;
  margin-bottom: 24px;
  flex-wrap: wrap;
}
.dj-left { display: flex; flex-direction: column; gap: 4px; min-width: 0; }
.dj-live {
  display: inline-flex; align-items: center; gap: 6px;
  font-size: .7rem; font-weight: 700; letter-spacing: .06em;
  text-transform: uppercase; color: var(--text-dim);
}
.dj-live.on { color: #f87171; }
.dj-dot {
  width: 8px; height: 8px; border-radius: 50%;
  background: currentColor; flex-shrink: 0;
}
.dj-live.on .dj-dot { animation: djpulse 1.2s ease-in-out infinite; }
@keyframes djpulse { 0%,100% { opacity:1; } 50% { opacity:.25; } }
.dj-title {
  font-size: 1rem; font-weight: 600;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  max-width: 220px;
}
.dj-artist {
  font-size: .83rem; color: var(--text-dim);
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  max-width: 220px;
}
.dj-center { flex: 1; min-width: 160px; }
.dj-progress-track {
  height: 5px; background: rgba(255,255,255,.1);
  border-radius: 5px; overflow: hidden; margin-bottom: 5px;
}
.dj-progress-fill {
  height: 100%; background: var(--accent);
  border-radius: 5px; width: 0%;
  transition: width .5s linear;
}
.dj-times {
  display: flex; justify-content: space-between;
  font-size: .72rem; color: var(--text-dim);
}
.dj-right { display: flex; align-items: center; gap: 10px; flex-shrink: 0; }
.dj-btn {
  display: inline-flex; align-items: center; justify-content: center;
  width: 38px; height: 38px; border-radius: 50%; border: none;
  background: rgba(255,255,255,.07); color: var(--text);
  cursor: pointer; transition: background .15s, transform .1s, color .15s;
  flex-shrink: 0;
}
.dj-btn:hover { background: rgba(0,200,160,.3); color: #fff; }
.dj-btn:active { transform: scale(.92); }
.dj-btn:disabled { opacity: .4; cursor: not-allowed; }
.dj-btn.active { background: var(--accent); color: #fff; }
.dj-vol { display: flex; align-items: center; gap: 6px; color: var(--text-dim); }
.dj-vol input[type=range] {
  width: 76px; accent-color: var(--accent);
  cursor: pointer; vertical-align: middle;
}
@media (max-width: 600px) {
  .dj-center { order: 3; flex-basis: 100%; min-width: 0; }
  .dj-right   { margin-left: auto; }
  .dj-title, .dj-artist { max-width: 160px; }
}
/* ── DJ Clock ──────────────────────────────────────── */
.dj-clock {
  text-align: center;
  padding: 18px 20px 14px;
  margin-bottom: 24px;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 10px;
}
.dj-clock-time {
  font-size: 3.4rem;
  font-weight: 700;
  letter-spacing: .04em;
  font-variant-numeric: tabular-nums;
  line-height: 1.1;
  color: var(--text);
}
.dj-clock-seconds {
  font-size: 2rem;
  opacity: .55;
  font-weight: 600;
}
.dj-clock-period {
  font-size: 2rem;
  opacity: .55;
  font-weight: 600;
  margin-left: 4px;
}
.dj-clock-date {
  font-size: .9rem;
  color: var(--text-dim);
  margin-top: 4px;
}
.dj-clock-weather {
  font-size: .82rem;
  color: var(--text-dim);
  margin-top: 6px;
  display: none;
}
.dj-clock-weather.visible { display: flex; justify-content: center; gap: 14px; align-items: center; }
.wx-item {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 4px;
  cursor: default;
}
.wx-item svg { vertical-align: middle; flex-shrink: 0; }
.wx-item .wx-val { font-weight: 600; color: var(--text); font-size: .88rem; }
.wx-item .wx-tip {
  position: absolute;
  bottom: calc(100% + 6px);
  left: 50%;
  transform: translateX(-50%);
  background: var(--surface-alt, #23232a);
  color: var(--text);
  padding: 4px 10px;
  border-radius: 6px;
  font-size: .75rem;
  white-space: nowrap;
  opacity: 0;
  pointer-events: none;
  transition: opacity .15s;
  z-index: 10;
}
.wx-item:hover .wx-tip { opacity: 1; }
@media (max-width: 600px) {
  .dj-clock-time { font-size: 2.4rem; }
  .dj-clock-seconds { font-size: 1.4rem; }
  .dj-clock-period { font-size: 1.4rem; }
}
/* ── Stream Control ─────────────────────────────────── */
.stream-ctrl {
  display: flex; align-items: center; gap: 14px;
  margin-bottom: 24px;
}
.btn-stream {
  display: inline-flex; align-items: center; gap: 8px;
  padding: 9px 22px; border-radius: 8px; border: none;
  font-weight: 600; font-size: .85rem;
  cursor: pointer; transition: background .15s, opacity .15s;
}
.btn-stream:disabled { opacity: .5; cursor: not-allowed; }
.btn-stream.active { background: #f87171; color: #fff; }
.btn-stream:not(.active) { background: #4ade80; color: #0a0a0c; }
.btn-stream-icon { flex-shrink: 0; }
.stream-status { font-size: .82rem; font-weight: 600; }
</style>
</head>
<body>
<div class="app">
  <button id="hamburger" class="hamburger">
    <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
  </button>
  <div id="overlay" class="overlay"></div>
  <aside id="sidebar" class="sidebar"></aside>

  <main class="main">
    <h1 class="page-title">Dashboard</h1>

    <!-- ── DJ Clock ──────────────────────────────────── -->
    <div class="dj-clock">
      <div class="dj-clock-time" id="djClockTime">00:00<span class="dj-clock-seconds">:00</span></div>
      <div class="dj-clock-date" id="djClockDate"></div>
      <div class="dj-clock-weather" id="djClockWeather"></div>
    </div>

    <!-- ── DJ Booth Monitor ─────────────────────────── -->
    <div class="dj-booth" id="djBooth">
      <div class="dj-left">
        <div class="dj-live" id="djLive"><span class="dj-dot"></span><span id="djLiveLabel">IDLE</span></div>
        <div class="dj-title" id="djTitle">— Idle —</div>
        <div class="dj-artist" id="djArtist"></div>
      </div>
      <div class="dj-center">
        <div class="dj-progress-track">
          <div class="dj-progress-fill" id="djProgressFill"></div>
        </div>
        <div class="dj-times">
          <span id="djElapsed">0:00</span>
          <span id="djRemaining">—</span>
        </div>
      </div>
      <div class="dj-right">
        <!-- Monitor / Stop -->
        <button class="dj-btn" id="djPlayBtn" title="Monitor stream">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
        </button>
        <!-- Skip -->
        <button class="dj-btn" id="djSkipBtn" title="Skip to next track">
          <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor"><path d="M6 18l8.5-6L6 6v12zm8-12v12l8.5-6z"/></svg>
        </button>
        <!-- Volume -->
        <div class="dj-vol">
          <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor" style="flex-shrink:0"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
          <input type="range" id="djVolume" min="0" max="100" value="80">
        </div>
      </div>
    </div>
    <audio id="djAudio" preload="none"></audio>

    <!-- ── Stream control ─────────────────────────── -->
    <div class="stream-ctrl">
      <button class="btn-stream active" id="streamToggle">
        <svg class="btn-stream-icon" viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path id="streamIcon" d="M6 6h12v12H6z"/></svg>
        <span id="streamLabel">Stop Stream</span>
      </button>
      <span class="stream-status" id="streamStatus">Broadcasting</span>
    </div>

    <!-- ── Status cards ─────────────────────────────── -->
    <div class="cards" id="cards">
      <div class="card">
        <div class="card-label">Now Playing</div>
        <div class="card-value" id="npTitle">—</div>
        <div class="card-sub" id="npArtist"></div>
        <div class="mt-8" id="npBadge"></div>
      </div>
      <div class="card">
        <div class="card-label">Up Next</div>
        <div class="card-value" id="ntTitle">—</div>
        <div class="card-sub" id="ntArtist"></div>
        <div class="mt-8" id="ntBadge"></div>
      </div>
      <div class="card">
        <div class="card-label">Listeners</div>
        <div class="card-value" id="listenerCount">0</div>
        <div class="card-sub">Peak today: <span id="listenerPeak">0</span></div>
      </div>
      <div class="card">
        <div class="card-label">Emergency Mode</div>
        <div class="card-value">
          <label class="toggle">
            <input type="checkbox" id="emergencyToggle">
            <span class="slider"></span>
          </label>
        </div>
        <div class="card-sub" id="emergencyStatus">Inactive</div>
      </div>
      <div class="card">
        <div class="card-label">Request Queue</div>
        <div class="card-value" id="approvedRequests">0</div>
        <div class="card-sub">Pending approval: <span id="pendingRequests">0</span></div>
      </div>
      <div class="card">
        <div class="card-label">Auto-approve Requests</div>
        <div class="card-value">
          <label class="toggle">
            <input type="checkbox" id="autoApproveToggle">
            <span class="slider"></span>
          </label>
        </div>
        <div class="card-sub" id="autoApproveStatus">Off</div>
      </div>
      <div class="card">
        <div class="card-label">Auto-tag Songs</div>
        <div class="card-value">
          <label class="toggle">
            <input type="checkbox" id="autoTagToggle">
            <span class="slider"></span>
          </label>
        </div>
        <div class="card-sub" id="autoTagStatus">Off</div>
      </div>
      <div class="card">
        <div class="card-label">Auto-normalize</div>
        <div class="card-value">
          <label class="toggle">
            <input type="checkbox" id="autoNormToggle">
            <span class="slider"></span>
          </label>
        </div>
        <div class="card-sub" id="autoNormStatus">Off</div>
      </div>
    </div>

    <!-- ── Library Overview ─────────────────────────── -->
    <div class="card" style="padding:24px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <h3 class="settings-section-title" style="margin-bottom:0">Library Overview</h3>
        <button class="btn btn-ghost btn-sm" id="btnRefreshStats" style="font-size:.75rem">Refresh</button>
      </div>
      <div id="libraryStats" class="stats-grid">
        <div class="spinner"></div>
      </div>
    </div>

    <!-- ── Recent activity ──────────────────────────── -->
    <h2 class="page-title" style="font-size:1.1rem;margin-top:8px">Recently Played</h2>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Played At</th>
            <th>Title</th>
            <th>Artist</th>
            <th>Genre</th>
            <th>Source</th>
          </tr>
        </thead>
        <tbody id="recentPlays">
          <tr><td colspan="5" class="empty">Loading…</td></tr>
        </tbody>
      </table>
    </div>
  </main>
</div>

<div class="toast-container" id="toasts"></div>

<script src="/assets/scroll-controls.js"></script>
<script src="/admin/js/api.js"></script>
<script src="/admin/js/auth.js"></script>
<script src="/admin/js/nav.js"></script>
<script src="/admin/js/dashboard.js?v=3"></script>
<script>
  if (iRadioAuth.requireLogin()) {
    iRadioNav.init();
    iRadioDashboard.init();
  }
</script>
</body>
</html>

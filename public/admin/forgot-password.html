<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin — Forgot Password</title>
<link rel="icon" type="image/svg+xml" href="/assets/icon.svg">
<link rel="stylesheet" href="/admin/css/admin.css?v=glow1">
</head>
<body>
<div class="login-wrap">
  <div class="login-box">
    <h1 id="brandTitle">Admin</h1>
    <div class="sub">Reset your password</div>
    <div id="error" class="text-danger text-center mb-16 hidden"></div>
    <div id="success" class="text-center mb-16 hidden" style="color:var(--success);font-size:.85rem"></div>
    <form id="forgotForm">
      <label for="email">Email address</label>
      <input type="email" id="email" autocomplete="email" required autofocus placeholder="Enter your account email">
      <button type="submit" id="btnSubmit" class="btn btn-primary" style="width:100%;justify-content:center">Send Reset Link</button>
    </form>
    <div style="text-align:center;margin-top:16px">
      <a href="/admin/" style="font-size:.8rem;color:var(--text-dim)">Back to Sign In</a>
    </div>
  </div>
  <footer class="site-footer">&copy; 2026 <a href="https://downstreamtech.net" target="_blank" rel="noopener">DownStreamTech</a>. All rights reserved.</footer>
</div>
<script src="/admin/js/theme.js"></script>
<script>
(function() {
  // Load station branding
  fetch('/api/config').then(function(r) { return r.json(); }).then(function(cfg) {
    var name = cfg.station_name || 'iRadio';
    document.getElementById('brandTitle').textContent = name;
    document.title = name + ' Admin — Forgot Password';
  }).catch(function() {});

  document.getElementById('forgotForm').addEventListener('submit', function(e) {
    e.preventDefault();
    var errEl     = document.getElementById('error');
    var successEl = document.getElementById('success');
    var btn       = document.getElementById('btnSubmit');
    var email     = document.getElementById('email').value.trim();

    errEl.classList.add('hidden');
    successEl.classList.add('hidden');
    btn.disabled = true;
    btn.textContent = 'Sending…';

    fetch('/api/forgot-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
      body: JSON.stringify({ email: email })
    })
    .then(function(res) { return res.json(); })
    .then(function(data) {
      if (data.error) {
        errEl.textContent = data.error;
        errEl.classList.remove('hidden');
      } else {
        successEl.textContent = data.message || 'Check your email for a reset link.';
        successEl.classList.remove('hidden');
        document.getElementById('forgotForm').style.display = 'none';
      }
    })
    .catch(function() {
      errEl.textContent = 'Something went wrong. Please try again.';
      errEl.classList.remove('hidden');
    })
    .finally(function() {
      btn.disabled = false;
      btn.textContent = 'Send Reset Link';
    });
  });
})();
</script>
</body>
</html>
